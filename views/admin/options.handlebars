<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="/grafico/admin.css">
    <div class="head-left">
      <a href="/usuarios/main"><button class="btn_home"></button></a>
    </div>
    <div class="head-right">
      <a href="/usuarios/teladesligar"><button class="btn_shutdown"></button></a>
    </div>
</head>
<body>
    <div class="title">Opções</div>
    <div class="search-table2">
      <div class="first-column">
          <div class="options">
            <div style="display:none">
              <button onclick='editFechamento()' class="line">
                <div class="line-l"><p>Fechamento Automático</p></div>
                <div class="line-r"><p id="fechamento"></p></div>
                <div class="line-r"><div id="line-1" class="select"></div></div>
              </button>
            </div>
            <div style="display:none">
              <button onclick='editDesligamento()' class="line">
                <div class="line-l"><p>Desligamento Automático</p></div>
                <div class="line-r"><p id="desligamento"></p></div>
                <div class="line-r"><div id="line-2" class="select"></div></div>
              </button>
            </div>
            <div>
              <button onclick='editEmail()' class="line">
                <div class="line-l"><p>E-mail para Envio de Relatórios</p></div>
                <div class="line-r"></div>
                <div class="line-r"><div id="line-3" class="select"></div></div>
              </button>
            </div>
            <div>
              <button onclick='editDataHora()' class="line">
                <div class="line-l"><p>Data e Hora</p></div>
                <div class="line-r"></div>
                <div class="line-r"><div id="line-4" class="select"></div></div>
              </button>
            </div>
            <div>
              <button onclick='deletarRegistros()' class="line">
                <div class="line-l"><p>Excluir registros do histórico</p></div>
                <div class="line-r"></div>
                <div class="line-r"><div id="line-5" class="select"></div></div>
              </button>
            </div>
            <div>
              <button onclick='telaAtualizacao()' class="line">
                <div class="line-l"><p>Atualizações do dispositivo</p></div>
                <div class="line-r"></div>
                <div class="line-r"><div id="line-6" class="select"></div></div>
              </button>
            </div>
            <div>
              <button onclick='editCartao()' class="line">
                <div class="line-l"><p>Acesso via Cartão</p></div>
                <div class="line-r" style="width: 20%"><div class='switch-on' id="switch-cartao"></div></div>
              </button>
            </div>
          </div>
      </div>
      <div id="SelectOptions" class="second-column" style="visibility: hidden">
        <div class='options'>
          <div id='Tab1' style="display:none">
            <button onclick='setFechamento(0)' class="line">
              <div class="line-l" style="width: 88%"><p>5 min</p></div>
              <div class="line-r"><div id="fech[0]" class="check" style="display:none"></div></div>
            </button>
            <button onclick='setFechamento(1)' class="line">
              <div class="line-l" style="width: 88%"><p>10 min</p></div>
              <div class="line-r"><div id="fech[1]" class="check" style="display:none"></div></div>
            </button>
            <button onclick='setFechamento(2)' class="line">
              <div class="line-l" style="width: 88%"><p>20 min</p></div>
              <div class="line-r"><div id="fech[2]" class="check" style="display:none"></div></div>
            </button>
            <button onclick='setFechamento(3)' class="line">
              <div class="line-l" style="width: 88%"><p>30 min</p></div>
              <div class="line-r"><div id="fech[3]" class="check" style="display:none"></div></div>
            </button>
          <button onclick='setFechamento(4)' class="line">
            <div class="line-l" style="width: 88%"><p>Nunca</p></div>
              <div class="line-r"><div id="fech[4]" class="check" style="display:none"></div></div>
          </button>
          </div>
          <div id='Tab2' style="display:none">
            <button onclick='setDesligamento(0)' class="line">
              <div class="line-l" style="width: 88%"><p>15 min</p></div>
              <div class="line-r"><div id="desl[0]" class="check" style="display:none"></div></div>
            </button>
            <button onclick='setDesligamento(1)' class="line">
              <div class="line-l" style="width: 88%"><p>30 min</p></div>
              <div class="line-r"><div id="desl[1]" class="check" style="display:none"></div></div>
            </button>
            <button onclick='setDesligamento(2)' class="line">
              <div class="line-l" style="width: 88%"><p>1 hora</p></div>
              <div class="line-r"><div id="desl[2]" class="check" style="display:none"></div></div>
            </button>
            <button onclick='setDesligamento(3)' class="line">
              <div class="line-l" style="width: 88%"><p>2 horas</p></div>
              <div class="line-r"><div id="desl[3]" class="check" style="display:none"></div></div>
            </button>
            <button onclick='setDesligamento(4)' class="line">
              <div class="line-l" style="width: 88%"><p>Nunca</p></div>
              <div class="line-r"><div id="desl[4]" class="check" style="display:none"></div></div>
            </button>
          </div>
          <div id='Tab3' style="display:none">
            <div class='enterData'>
              <div style="align: center">
                <div style="margin-top: 165px">
                  <p>E-mail:</p>
                  <div class="search-input medium">
                    <input id="boxEmail" value="{{configuracoes.email}}" onclick='resetEmail()' class="use-keyboard-input-null" type="email" style="text-align: center; font-size: 20px;"></input>
                  </div>
                </div>
                <div style="margin-top:40px; margin-left: 138px">
                  <button type="submit" class="btns" onclick="setEmail()">
                    <p>Confirmar</p>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div id='Tab4' style="display:none">
            <div class="data-hora">
              <div class="first-column">
                <div class="line" style="border-top: none; border-bottom: none; margin-top:65px">
                  <div class="column">
                    <button class="btns-alterar-up" onclick="up_dia()"></button>
                    <p id="dia"></p>
                    <button class="btns-alterar-down" onclick="down_dia()"></button>
                  </div>
                  <p style="margin-top: 95px; margin-left: -10px">/</p>
                  <div class="column">
                    <button class="btns-alterar-up" onclick="up_mes()"></button>
                    <p id="mes"></p>
                    <button class="btns-alterar-down" onclick="down_mes()"></button>
                  </div>
                  <p style="margin-top: 95px; margin-left: -10px">/</p>
                  <div class="column">
                    <button class="btns-alterar-up" onclick="up_ano()"></button>
                    <p id="ano"></p>
                    <button class="btns-alterar-down" onclick="down_ano()"></button>
                  </div>
                </div>
                <div class="line" style="border-top: none; border-bottom: none; margin-top:120px">
                  <div class="column">
                    <button class="btns-alterar-up" onclick="up_hora()"></button>
                    <p id="hora"></p>
                    <button class="btns-alterar-down" onclick="down_hora()"></button>
                  </div>
                  <p style="margin-top: 90px; margin-left: -10px">:</p>
                  <div class="column">
                    <button class="btns-alterar-up" onclick="up_minuto()"></button>
                    <p id="minuto"></p>
                    <button class="btns-alterar-down" onclick="down_minuto()"></button>
                  </div>
                </div>
                <div class="line" style="border-top: none; border-bottom: none; margin-top:125px">
                  <button class="btns" onclick="alteraDataHora()">
                    <p>Confirmar</p>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div id='Tab5' style="display:none">
            <div class='enterData'>
              <div style="align: left">
                <div style="margin-top: 120px">
                  <p>Excluir registros com ferramentas devolvidas:</p>
                </div>
                <div style="margin-top:20px; margin-left: 80px">
                  <button type="submit" class="btns" onclick="excluirRegistros(0)">
                    <p>Excluir</p>
                  </button>
                </div>
                <div style="margin-top: 50px">
                  <p>Excluir todos os registros:</p>
                </div>
                <div style="margin-top:20px; margin-left: 80px">
                  <button type="submit" class="btns" onclick="excluirRegistros(1)">
                    <p>Excluir</p>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div id='Tab6' style="display:none">
            <div class='enterData'>
              <div style="align: left">
                <div style="margin-top: 200px">
                  <p>Atualizar dispositivo para a versão mais recente:</p>
                </div>
                <div style="margin-top:20px; margin-left: 90px">
                  <a href="/admin/atualizacao" style="text-decoration: none"><button type="submit" class="btns">
                    <p>Atualizar</p>
                  </button></a>
                </div>
                <div style="margin-top: 175px; margin-left: -70px">
                  <p>Versão atual: 0.101</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      
      // ===== Configurações gerais =====

      var socket = io.connect();
      var confFechamento = {{configuracoes.fechamento}};
      var strFechamento = ['5 min', '10 min', '20 min', '30 min', 'Nunca']
      var confCartao = {{configuracoes.cartao}};
      var confDesligamento = {{configuracoes.desligamento}};
      var strDesligamento = ['15 min', '30 min', '1 hora', '2 horas', 'Nunca']
      //var mail = document.getElementById("email").innerHTML;
      //confEmail = document.getElementById("email").innerHTML;
      
      document.getElementById("fechamento").innerHTML = strFechamento[confFechamento];
      document.getElementById("desligamento").innerHTML = strDesligamento[confDesligamento];
      //document.getElementById("email").innerHTML = confEmail;
      document.getElementById("fech["+confFechamento+"]").style = "display:visible";
      document.getElementById("desl["+confDesligamento+"]").style = "display:visible";
      
      if (confCartao==1)
        document.getElementById("switch-cartao").className = "switch-on";
      else
        document.getElementById("switch-cartao").className = "switch-off";

      function editFechamento(){
        document.getElementById("SelectOptions").style = "visibility:visible";
        document.getElementById("Tab1").style = "display:visible";
        document.getElementById("line-1").style = "display:visible";
        document.getElementById("Tab2").style = "display:none";
        document.getElementById("line-2").style = "display:none";
        document.getElementById("Tab3").style = "display:none";
        document.getElementById("line-3").style = "display:none";
        document.getElementById("Tab4").style = "display:none";
        document.getElementById("line-4").style = "display:none";
        document.getElementById("Tab5").style = "display:none";
        document.getElementById("line-5").style = "display:none";
        document.getElementById("Tab6").style = "display:none";
        document.getElementById("line-6").style = "display:none";
      }

      function setFechamento(data){
        confFechamento = data;
        setTimeout(function(){
          document.getElementById("SelectOptions").style = "visibility:hidden"
          document.getElementById("Tab1").style = "display:none"
          document.getElementById("line-1").style = "display:none";}, 100)
        document.getElementById("fechamento").innerHTML = strFechamento[confFechamento];
        editCheckFechamento(confFechamento);
        salvaConfig();
      }

      function editCheckFechamento(data){
        document.getElementById("fech[0]").style = "display:none";
        document.getElementById("fech[1]").style = "display:none";
        document.getElementById("fech[2]").style = "display:none";
        document.getElementById("fech[3]").style = "display:none";
        document.getElementById("fech[4]").style = "display:none";
        document.getElementById("fech["+data+"]").style = "display:visible";
      }

      function editCartao(){
        //document.getElementById("SelectOptions").style = "visibility:hidden";
        //document.getElementById("Tab1").style = "display:none";
        //document.getElementById("Tab2").style = "display:none";
        if (confCartao==0){
          confCartao = 1;
          document.getElementById("switch-cartao").className = "switch-on";}
        else{
          confCartao = 0;
          document.getElementById("switch-cartao").className = "switch-off";}
        salvaConfig();
      }

      function editDesligamento(){
        document.getElementById("SelectOptions").style = "visibility:visible";
        document.getElementById("Tab1").style = "display:none";
        document.getElementById("line-1").style = "display:none";
        document.getElementById("Tab2").style = "display:visible"; 
        document.getElementById("line-2").style = "display:visible";
        document.getElementById("Tab3").style = "display:none";
        document.getElementById("line-3").style = "display:none";
        document.getElementById("Tab4").style = "display:none";
        document.getElementById("line-4").style = "display:none";
        document.getElementById("Tab5").style = "display:none";
        document.getElementById("line-5").style = "display:none";
        document.getElementById("Tab6").style = "display:none";
        document.getElementById("line-6").style = "display:none";
      }

      function setDesligamento(data){
        confDesligamento = data;
        setTimeout(function(){
          document.getElementById("SelectOptions").style = "visibility:hidden"
          document.getElementById("Tab2").style = "display:none"
          document.getElementById("line-2").style = "display:none";}, 100)
        document.getElementById("desligamento").innerHTML = strDesligamento[confDesligamento];
        editCheckDesligamento(confDesligamento);
        salvaConfig();
      }

      function editCheckDesligamento(data){
        document.getElementById("desl[0]").style = "display:none";
        document.getElementById("desl[1]").style = "display:none";
        document.getElementById("desl[2]").style = "display:none";
        document.getElementById("desl[3]").style = "display:none";
        document.getElementById("desl[4]").style = "display:none";
        document.getElementById("desl["+data+"]").style = "display:visible";
      }

      function resetEmail(){
        document.getElementById("boxEmail").value = '';
      }

      function editEmail(){
        //document.getElementById("boxEmail").value = '';
        document.getElementById("SelectOptions").style = "visibility:visible";
        document.getElementById("Tab1").style = "display:none";
        document.getElementById("line-1").style = "display:none";
        document.getElementById("Tab2").style = "display:none";
        document.getElementById("line-2").style = "display:none";
        document.getElementById("Tab3").style = "display:visible";
        document.getElementById("line-3").style = "display:visible";
        document.getElementById("Tab4").style = "display:none";
        document.getElementById("line-4").style = "display:none";
        document.getElementById("Tab5").style = "display:none";
        document.getElementById("line-5").style = "display:none";
        document.getElementById("Tab6").style = "display:none";
        document.getElementById("line-6").style = "display:none";
      }

      function deletarRegistros(){
        //document.getElementById("boxEmail").value = '';
        document.getElementById("SelectOptions").style = "visibility:visible";
        document.getElementById("Tab1").style = "display:none";
        document.getElementById("line-1").style = "display:none";
        document.getElementById("Tab2").style = "display:none";
        document.getElementById("line-2").style = "display:none";
        document.getElementById("Tab3").style = "display:none";
        document.getElementById("line-3").style = "display:none";
        document.getElementById("Tab4").style = "display:none";
        document.getElementById("line-4").style = "display:none";
        document.getElementById("Tab5").style = "display:visible";
        document.getElementById("line-5").style = "display:visible";
        document.getElementById("Tab6").style = "display:none";
        document.getElementById("line-6").style = "display:none";
      }

      function telaAtualizacao(){
        //document.getElementById("boxEmail").value = '';
        document.getElementById("SelectOptions").style = "visibility:visible";
        document.getElementById("Tab1").style = "display:none";
        document.getElementById("line-1").style = "display:none";
        document.getElementById("Tab2").style = "display:none";
        document.getElementById("line-2").style = "display:none";
        document.getElementById("Tab3").style = "display:none";
        document.getElementById("line-3").style = "display:none";
        document.getElementById("Tab4").style = "display:none";
        document.getElementById("line-4").style = "display:none";
        document.getElementById("Tab5").style = "display:none";
        document.getElementById("line-5").style = "display:none";
        document.getElementById("Tab6").style = "display:visible";
        document.getElementById("line-6").style = "display:visible";
      }

      function setEmail(){
        //confEmail = document.getElementById("email").value
        //document.getElementById("email").innerHTML = document.getElementById("boxEmail").value;
        setTimeout(function(){
          document.getElementById("SelectOptions").style = "visibility:hidden"
          document.getElementById("Tab3").style = "display:none"
          document.getElementById("line-3").style = "display:none";}, 100)
        salvaConfig();
      }

      function salvaConfig(){
        var confEmail = document.getElementById("boxEmail").value
        socket.emit('salvaConfiguracoes', confFechamento, confCartao, confDesligamento, confEmail)
      }

      function excluirRegistros(data){
        if (data==0){
          socket.emit('excluiRegistros', 0)
        }
        else if (data==1){
          socket.emit('excluiRegistros', 1)
        }
        setTimeout(function(){
          document.getElementById("SelectOptions").style = "visibility:hidden"
          document.getElementById("Tab5").style = "display:none"
          document.getElementById("line-5").style = "display:none";}, 100)
      }

      //function atualizarDispositivo(){
      //  socket.emit('auxAtualizaDispositivo')
      //}

      document.getElementById("line-1").style = "display:none";
      document.getElementById("line-2").style = "display:none";
      document.getElementById("line-3").style = "display:none";
      document.getElementById("line-4").style = "display:none";
      document.getElementById("line-5").style = "display:none";
      document.getElementById("line-6").style = "display:none";


      // ===== Configurações de data e hora =====

      var arrDataMax = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]

      var today=new Date();
      var dia=today.getDate();
      var mes=today.getMonth()+1; //Inicia em 0
      var ano=today.getFullYear();
      var hora=today.getHours();
      var minuto=today.getMinutes();
      
      function editDataHora(){
        today=new Date();
        dia=today.getDate();
        mes=today.getMonth()+1; //Inicia em 0
        ano=today.getFullYear();
        hora=today.getHours();
        minuto=today.getMinutes();
        document.getElementById('dia').innerHTML=(dia<10)?('0'+dia):dia;
        document.getElementById('mes').innerHTML=(mes<10)?('0'+mes):mes;
        document.getElementById('ano').innerHTML=ano;
        document.getElementById('hora').innerHTML=(hora<10)?('0'+hora):hora;
        document.getElementById('minuto').innerHTML=(minuto<10)?('0'+minuto):minuto;
        document.getElementById("SelectOptions").style = "visibility:visible";
        document.getElementById("Tab1").style = "display:none";
        document.getElementById("line-1").style = "display:none";
        document.getElementById("Tab2").style = "display:none";
        document.getElementById("line-2").style = "display:none";
        document.getElementById("Tab3").style = "display:none";
        document.getElementById("line-3").style = "display:none";
        document.getElementById("Tab4").style = "display:visible";
        document.getElementById("line-4").style = "display:visible";
        document.getElementById("Tab5").style = "display:none";
        document.getElementById("line-5").style = "display:none";
        document.getElementById("Tab6").style = "display:none";
        document.getElementById("line-6").style = "display:none";
      }

      function up_dia(){
        dia = (dia<arrDataMax[mes-1])?(dia+1):1;
        document.getElementById('dia').innerHTML=(dia<10)?('0'+dia):dia;
      }
      function down_dia(){
        dia = (dia>1)?(dia-1):arrDataMax[mes-1];
        document.getElementById('dia').innerHTML=(dia<10)?('0'+dia):dia;
      }
      function up_mes(){
        mes = (mes<12)?(mes+1):1;
        if (dia>arrDataMax[mes-1]){
          dia = arrDataMax[mes-1]
          document.getElementById('dia').innerHTML=(dia<10)?('0'+dia):dia;
        }
        document.getElementById('mes').innerHTML=(mes<10)?('0'+mes):mes;
      }
      function down_mes(){
        mes = (mes>1)?(mes-1):12;
        if (dia>arrDataMax[mes-1]){
          dia = arrDataMax[mes-1]
          document.getElementById('dia').innerHTML=(dia<10)?('0'+dia):dia;
        }
        document.getElementById('mes').innerHTML=(mes<10)?('0'+mes):mes;
      }
      function up_ano(){
        ano = ano+1;
        document.getElementById('ano').innerHTML=ano;
      }
      function down_ano(){
        ano = ano-1;
        document.getElementById('ano').innerHTML=ano;
      }
      function up_hora(){
        hora = (hora<23)?(hora+1):0;
        document.getElementById('hora').innerHTML=(hora<10)?('0'+hora):hora;
      }
      function down_hora(){
        hora = (hora>0)?(hora-1):23;
        document.getElementById('hora').innerHTML=(hora<10)?('0'+hora):hora;
      }
      function up_minuto(){
        minuto = (minuto<59)?(minuto+1):0;
        document.getElementById('minuto').innerHTML=(minuto<10)?('0'+minuto):minuto;
      }
      function down_minuto(){
        minuto = (minuto>0)?(minuto-1):59;
        document.getElementById('minuto').innerHTML=(minuto<10)?('0'+minuto):minuto;
      }

      function alteraDataHora(){
        socket.emit('alteraDataHora', (String(mes)+'/'+String(dia)+'/'+String(ano)+' '+String(hora)+':'+String(minuto)+':00'))
        setTimeout(function(){
          document.getElementById("SelectOptions").style = "visibility:hidden"
          document.getElementById("Tab4").style = "display:none"
          document.getElementById("line-4").style = "display:none";}, 100)
      }

    </script>
</body>
<foot>
  <div class="footer">
    <a href="/usuarios/main"><button class="btn_return"></button></a>
  </div>
</foot>
